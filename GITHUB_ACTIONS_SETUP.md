# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

## üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ GitHub Actions

–í–∞—à Python SDK –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ GitHub Actions —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OpenID Connect (OIDC) –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å PyPI.

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Environment

### 1. –°–æ–∑–¥–∞–π—Ç–µ GitHub Environment

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub
2. –ù–∞–∂–º–∏—Ç–µ **Settings** ‚Üí **Environments**
3. –ù–∞–∂–º–∏—Ç–µ **New environment**
4. –í–≤–µ–¥–∏—Ç–µ –∏–º—è: `pypi`
5. –ù–∞–∂–º–∏—Ç–µ **Configure environment**

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Protection Rules (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

- ‚úÖ **Required reviewers**: –î–æ–±–∞–≤—å—Ç–µ —Å–µ–±—è –∫–∞–∫ reviewer
- ‚úÖ **Wait timer**: 0 –º–∏–Ω—É—Ç (–∏–ª–∏ –ø–æ –∂–µ–ª–∞–Ω–∏—é)
- ‚úÖ **Deployment branches**: –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —Ç–æ–ª—å–∫–æ `main` –≤–µ—Ç–∫–æ–π

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Environment Secrets

–í —Ä–∞–∑–¥–µ–ª–µ **Environment secrets** –¥–æ–±–∞–≤—å—Ç–µ:

- `TEST_PYPI_API_TOKEN` - API —Ç–æ–∫–µ–Ω –¥–ª—è Test PyPI (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PyPI Trusted Publishing

### 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PyPI

1. –í–æ–π–¥–∏—Ç–µ –≤ [PyPI](https://pypi.org)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Account settings** ‚Üí **Publishing**
3. –ù–∞–∂–º–∏—Ç–µ **Add a new pending publisher**

### 2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É

```
PyPI Project Name: contentgem-python
Owner: GemContent
Repository name: GemContent
Workflow name: workflow.yml
Environment name: pypi
```

### 3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- –ù–∞–∂–º–∏—Ç–µ **Add pending publisher**
- GitHub –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç pull request –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

## üéØ –°–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø—Ä–∏ —Ä–µ–ª–∏–∑–µ

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –∏ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ —Ä–µ–ª–∏–∑
git tag v1.0.0
git push origin v1.0.0

# –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ª–∏–∑ –Ω–∞ GitHub —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
# Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∏ –æ–ø—É–±–ª–∏–∫—É–µ—Ç –ø–∞–∫–µ—Ç
```

### 2. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GitHub Actions

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Actions** ‚Üí **Publish Python Package to PyPI**
2. –ù–∞–∂–º–∏—Ç–µ **Run workflow**
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É –∏ –æ–ø—Ü–∏–∏:
   - `test_pypi: false` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π PyPI
   - `test_pypi: true` - –ø—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ Test PyPI

### 3. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ GitHub CLI

```bash
# –ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π PyPI
gh workflow run "Publish Python Package to PyPI" --ref main

# –ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ Test PyPI
gh workflow run "Publish Python Package to PyPI" --ref main -f test_pypi=true
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### 1. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Actions** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ workflow run
- –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

### 2. –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PyPI Trusted Publisher –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Environment `pypi` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏:**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∫–∞–∑–∞–Ω—ã –≤ `setup.py`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–¥ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã

**–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–µ—Ä—Å–∏—è –ø–∞–∫–µ—Ç–∞ —É–Ω–∏–∫–∞–ª—å–Ω–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞–∫–µ—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ PyPI

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ workflow

### –û—Å–Ω–æ–≤–Ω–æ–π workflow (`workflow.yml`)

- ‚úÖ **–¢—Ä–∏–≥–≥–µ—Ä—ã**: —Ä–µ–ª–∏–∑—ã –∏ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
- ‚úÖ **–°–±–æ—Ä–∫–∞**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –ø–∞–∫–µ—Ç–∞
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞
- ‚úÖ **–ü—É–±–ª–∏–∫–∞—Ü–∏—è**: –Ω–∞ PyPI –∏–ª–∏ Test PyPI
- ‚úÖ **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –¢–µ—Å—Ç–æ–≤—ã–π workflow (`test.yml`)

- ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –Ω–∞ Python 3.8-3.12
- ‚úÖ **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: black, flake8, mypy
- ‚úÖ **–°–±–æ—Ä–∫–∞**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏ –ø–∞–∫–µ—Ç–∞
- ‚úÖ **–£—Å—Ç–∞–Ω–æ–≤–∫–∞**: —Ç–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ª–∏–∑** –Ω–∞ GitHub
2. **Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è**
3. **–ü–∞–∫–µ—Ç –±—É–¥–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω** –Ω–∞ PyPI
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å** —á–µ—Ä–µ–∑ `pip install contentgem-python`

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏

–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏:

1. –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –≤ `contentgem/__init__.py`
2. –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é –≤ `setup.py`
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ä–µ–ª–∏–∑ –Ω–∞ GitHub
4. Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—É–±–ª–∏–∫—É–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [GitHub Actions Documentation](https://docs.github.com/en/actions)
- [PyPI Trusted Publishing](https://docs.pypi.org/trusted-publishing/)
- [OpenID Connect](https://docs.github.com/en/actions/deployment/security/hardening-your-deployments/about-security-hardening-with-openid-connect)
